<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sea Ranch Stargazing</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide icons as inline SVG components
        const Moon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
            </svg>
        );

        const Cloud = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"></path>
            </svg>
        );

        const Eye = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            </svg>
        );

        const MapPin = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const Calendar = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const Info = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
        );

        const StargazingApp = () => {
            const [forecast, setForecast] = useState([]);
            const [loading, setLoading] = useState(true);
            const [currentConditions, setCurrentConditions] = useState(null);

            // Sea Ranch, CA coordinates
            const LAT = 38.7158;
            const LON = -123.4528;

            useEffect(() => {
                fetchWeatherData();
            }, []);

            const fetchWeatherData = async () => {
                try {
                    // Fetch weather forecast
                    const response = await fetch(
                        `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max,cloud_cover_mean&current=temperature_2m,cloud_cover,wind_speed_10m&timezone=America/Los_Angeles&forecast_days=7`
                    );
                    const data = await response.json();
                    
                    const dailyForecasts = data.daily.time.map((date, index) => {
                        const moonPhase = calculateMoonPhase(new Date(date));
                        const cloudCover = data.daily.cloud_cover_mean[index];
                        const precipitation = data.daily.precipitation_probability_max[index];
                        
                        return {
                            date,
                            tempMax: Math.round(data.daily.temperature_2m_max[index]),
                            tempMin: Math.round(data.daily.temperature_2m_min[index]),
                            cloudCover,
                            precipitation,
                            moonPhase: moonPhase.phase,
                            moonIllumination: moonPhase.illumination,
                            stargazingScore: calculateStargazingScore(cloudCover, precipitation, moonPhase.illumination)
                        };
                    });

                    setForecast(dailyForecasts);
                    setCurrentConditions({
                        temp: Math.round(data.current.temperature_2m),
                        cloudCover: data.current.cloud_cover,
                        windSpeed: Math.round(data.current.wind_speed_10m)
                    });
                    setLoading(false);
                } catch (error) {
                    console.error('Error fetching weather:', error);
                    setLoading(false);
                }
            };

            const calculateMoonPhase = (date) => {
                const LUNAR_CYCLE = 29.53058867;
                const KNOWN_NEW_MOON = new Date('2000-01-06T18:14:00Z');
                
                const daysSinceNew = (date - KNOWN_NEW_MOON) / (1000 * 60 * 60 * 24);
                const phaseNumber = (daysSinceNew % LUNAR_CYCLE) / LUNAR_CYCLE;
                
                let phase = '';
                let illumination = 0;
                
                if (phaseNumber < 0.0625) {
                    phase = 'New Moon';
                    illumination = 0;
                } else if (phaseNumber < 0.1875) {
                    phase = 'Waxing Crescent';
                    illumination = 25;
                } else if (phaseNumber < 0.3125) {
                    phase = 'First Quarter';
                    illumination = 50;
                } else if (phaseNumber < 0.4375) {
                    phase = 'Waxing Gibbous';
                    illumination = 75;
                } else if (phaseNumber < 0.5625) {
                    phase = 'Full Moon';
                    illumination = 100;
                } else if (phaseNumber < 0.6875) {
                    phase = 'Waning Gibbous';
                    illumination = 75;
                } else if (phaseNumber < 0.8125) {
                    phase = 'Last Quarter';
                    illumination = 50;
                } else {
                    phase = 'Waning Crescent';
                    illumination = 25;
                }
                
                return { phase, illumination };
            };

            const calculateStargazingScore = (cloudCover, precipitation, moonIllumination) => {
                // Score from 0-100
                let score = 100;
                
                // Cloud cover penalty (0-100% clouds)
                score -= cloudCover * 0.6;
                
                // Precipitation penalty
                score -= precipitation * 0.2;
                
                // Moon illumination penalty (full moon reduces visibility)
                score -= moonIllumination * 0.2;
                
                return Math.max(0, Math.round(score));
            };

            const getScoreColor = (score) => {
                if (score >= 80) return 'text-green-500';
                if (score >= 60) return 'text-yellow-500';
                if (score >= 40) return 'text-orange-500';
                return 'text-red-500';
            };

            const getScoreLabel = (score) => {
                if (score >= 80) return 'Excellent';
                if (score >= 60) return 'Good';
                if (score >= 40) return 'Fair';
                return 'Poor';
            };

            const formatDate = (dateString) => {
                const date = new Date(dateString);
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                if (date.toDateString() === today.toDateString()) return 'Today';
                if (date.toDateString() === tomorrow.toDateString()) return 'Tomorrow';
                
                return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            };

            const getMoonIcon = (phase) => {
                const phases = {
                    'New Moon': 'üåë',
                    'Waxing Crescent': 'üåí',
                    'First Quarter': 'üåì',
                    'Waxing Gibbous': 'üåî',
                    'Full Moon': 'üåï',
                    'Waning Gibbous': 'üåñ',
                    'Last Quarter': 'üåó',
                    'Waning Crescent': 'üåò'
                };
                return phases[phase] || 'üåô';
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-indigo-950 via-purple-950 to-slate-950 flex items-center justify-center">
                        <div className="text-white text-xl">Loading stargazing forecast...</div>
                    </div>
                );
            }

            const bestNight = forecast.reduce((best, night) => 
                night.stargazingScore > best.stargazingScore ? night : best
            , forecast[0]);

            return (
                <div className="min-h-screen bg-gradient-to-b from-indigo-950 via-purple-950 to-slate-950 text-white p-4 pb-8">
                    {/* Header */}
                    <div className="max-w-2xl mx-auto">
                        <div className="text-center mb-8 pt-4">
                            <div className="flex items-center justify-center gap-2 mb-2">
                                <Eye className="w-8 h-8" />
                                <h1 className="text-3xl font-bold">Sea Ranch Stargazing</h1>
                            </div>
                            <div className="flex items-center justify-center gap-1 text-indigo-300">
                                <MapPin className="w-4 h-4" />
                                <span className="text-sm">Sea Ranch, California</span>
                            </div>
                        </div>

                        {/* Current Conditions */}
                        {currentConditions && (
                            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-6 border border-white/20">
                                <h2 className="text-xl font-semibold mb-4">Current Conditions</h2>
                                <div className="grid grid-cols-3 gap-4 text-center">
                                    <div>
                                        <div className="text-3xl font-bold">{currentConditions.temp}¬∞F</div>
                                        <div className="text-sm text-indigo-300">Temperature</div>
                                    </div>
                                    <div>
                                        <div className="text-3xl font-bold">{currentConditions.cloudCover}%</div>
                                        <div className="text-sm text-indigo-300">Cloud Cover</div>
                                    </div>
                                    <div>
                                        <div className="text-3xl font-bold">{currentConditions.windSpeed} mph</div>
                                        <div className="text-sm text-indigo-300">Wind Speed</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Best Night Highlight */}
                        <div className="bg-gradient-to-r from-yellow-500/20 to-orange-500/20 backdrop-blur-sm rounded-2xl p-6 mb-6 border-2 border-yellow-400/50">
                            <div className="flex items-center gap-2 mb-3">
                                <div className="text-2xl">‚≠ê</div>
                                <h2 className="text-xl font-semibold">Best Night This Week</h2>
                            </div>
                            <div className="flex justify-between items-center">
                                <div>
                                    <div className="text-2xl font-bold">{formatDate(bestNight.date)}</div>
                                    <div className="text-indigo-200 text-sm">{bestNight.moonPhase}</div>
                                </div>
                                <div className="text-right">
                                    <div className={`text-4xl font-bold ${getScoreColor(bestNight.stargazingScore)}`}>
                                        {bestNight.stargazingScore}
                                    </div>
                                    <div className="text-sm text-indigo-300">{getScoreLabel(bestNight.stargazingScore)}</div>
                                </div>
                            </div>
                        </div>

                        {/* Info Box */}
                        <div className="bg-blue-500/10 backdrop-blur-sm rounded-xl p-4 mb-6 border border-blue-400/30">
                            <div className="flex gap-2">
                                <Info className="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" />
                                <div className="text-sm text-blue-200">
                                    Stargazing scores consider cloud cover, precipitation chance, and moon brightness. 
                                    New moon nights with clear skies offer the best viewing conditions.
                                </div>
                            </div>
                        </div>

                        {/* 7-Day Forecast */}
                        <div className="space-y-3">
                            <h2 className="text-2xl font-semibold mb-4 flex items-center gap-2">
                                <Calendar className="w-6 h-6" />
                                7-Day Forecast
                            </h2>
                            
                            {forecast.map((day, index) => (
                                <div 
                                    key={index}
                                    className="bg-white/10 backdrop-blur-sm rounded-xl p-5 border border-white/20 hover:bg-white/15 transition-colors"
                                >
                                    <div className="flex justify-between items-start mb-3">
                                        <div>
                                            <div className="text-lg font-semibold">{formatDate(day.date)}</div>
                                            <div className="text-sm text-indigo-300">
                                                {day.tempMax}¬∞ / {day.tempMin}¬∞F
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div className={`text-3xl font-bold ${getScoreColor(day.stargazingScore)}`}>
                                                {day.stargazingScore}
                                            </div>
                                            <div className="text-xs text-indigo-300">{getScoreLabel(day.stargazingScore)}</div>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-cols-3 gap-3 text-sm">
                                        <div className="flex items-center gap-2">
                                            <Cloud className="w-4 h-4 text-indigo-300" />
                                            <div>
                                                <div className="font-medium">{Math.round(day.cloudCover)}%</div>
                                                <div className="text-xs text-indigo-400">Clouds</div>
                                            </div>
                                        </div>
                                        
                                        <div className="flex items-center gap-2">
                                            <div className="text-xl">{getMoonIcon(day.moonPhase)}</div>
                                            <div>
                                                <div className="font-medium">{day.moonIllumination}%</div>
                                                <div className="text-xs text-indigo-400">Moon</div>
                                            </div>
                                        </div>
                                        
                                        <div className="flex items-center gap-2">
                                            <div className="text-xl">üíß</div>
                                            <div>
                                                <div className="font-medium">{day.precipitation}%</div>
                                                <div className="text-xs text-indigo-400">Rain</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="mt-3 pt-3 border-t border-white/10">
                                        <div className="text-xs text-indigo-300">{day.moonPhase}</div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Footer */}
                        <div className="text-center mt-8 text-sm text-indigo-400">
                            <p>Data from Open-Meteo ‚Ä¢ Best viewing after astronomical twilight</p>
                            <p className="mt-2">üåå Clear skies and happy stargazing! üåå</p>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StargazingApp />);
    </script>
</body>
</html>
